<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Liste des Projets</title>
    {{ template "layouts/include-css.html" }}
</head>
<body>
{{ template "layouts/topbar.html" }}

<div class="container-fluid">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h4>{{ .PaginatedItems.TotalItemCount }} projets en tout - {{ len .PaginatedItems.Items }} projets
                affiches</h4>
        </div>
        <div class="panel-body">
            <span class="dropdown">
                <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1"
                        data-toggle="dropdown" aria-expanded="true">
                    {{ .Limit }} Projets par page
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                    <li role="presentation">
                        <a role="menuitem" tabindex="-1" href="/projects/list?page=1&limit=15">15</a>
                    </li>
                    <li role="presentation">
                        <a role="menuitem" tabindex="-1" href="/projects/list?page=1&limit=30">30</a>
                    </li>
                    <li role="presentation">
                        <a role="menuitem" tabindex="-1" href="/projects/list?page=1&limit=50">50</a>
                    </li>
                    <li role="presentation">
                        <a role="menuitem" tabindex="-1" href="/projects/list?page=1&limit=100">100</a>
                    </li>
                </ul>
            </span>

            <span class="pull-right">
            <a class="btn btn-primary" href="/projects/add">Lancer un projet</a>
            </span>

            <div class="row-fluid">

                <div class="col-md-10">
                    <table class="table table-striped table-hover">
                        <thead>
                        <tr>
                            <td>Name</td>
                            <td>Promotions</td>
                            <td>Villes</td>
                            <td>Personne(s) sur le projet</td>
                            <td>Technos</td>
                            <td>Themes</td>
                            <td>Manageur</td>
                        </tr>
                        </thead>
                        {{ range $element := .PaginatedItems.Items }}

                        <tr>
                            <td><a href="/projects/{{ $element.Name }}">{{ $element.Name }}</a></td>
                            <td>{{ $element.Promotions }}</td>
                            <td>{{ $element.Cities }}</td>
                            <td>{{ len $element.Members }}</td>
                            <td></td>
                            <td></td>
                            <td>
                                {{ if $element.Manager }}
                                {{ $element.Manager.Login }}
                                {{ end }}
                            </td>
                        </tr>
                        {{ end }}
                    </table>
                    <ul class="pagination center-block">
                        {{ if .HasPreviousPage }}
                        <li><a href="/projects/list?page={{ decr .PaginatedItems.CurrentPage }}&limit={{ .Limit }}">
                            <span class="glyphicon glyphicon-chevron-left"></span></a></li>
                        {{ end }}
                        {{ if .ShowGoToFirst }}
                        <li><a href="/projects/list?page=1&limit={{ .Limit }}">
                            1
                        </a></li>
                        {{ end }}
                        {{ range $element := .PaginatedItems.PagesToShow }}
                        <li class="{{ if eq $element $.PaginatedItems.CurrentPage }}active{{ end }}">
                            <a class="text-primary" href="/projects/list?page={{ $element }}&limit={{ $.Limit }}">
                                {{ $element }}</a></li>
                        {{ end }}
                        {{ if .ShowGoToLast }}
                        <li><a href="/projects/list?page={{ .PaginatedItems.TotalPageCount }}&limit={{ .Limit }}">
                            {{ .PaginatedItems.TotalPageCount }}
                        </a></li>
                        {{ end }}
                        {{ if .HasNextPage }}
                        <li><a href="/projects/list?page={{ incr .PaginatedItems.CurrentPage }}&limit={{ .Limit }}">
                            <span class="glyphicon glyphicon-chevron-right"></span></a></li>
                        {{ end }}
                    </ul>

                </div>

                <div class="col-md-2">
                    <h4>Recherche</h4>

                    <div class="form-group">
                        <label for="promotions">Promotion</label>
                        <select id="promotions" class="form-control" multiple="multiple">
                            <option></option>
                            {{ range $element := .Promotions }}
                            <option>{{ $element.Name }}</option>
                            {{ end }}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="cities">Ville</label>
                        <select id="cities" class="form-control" multiple="multiple">
                            <option></option>
                            {{ range $element := .Cities }}
                            <option>{{ $element.Name }}</option>
                            {{ end }}
                        </select>
                    </div>

                    <button class="btn btn-primary" onclick="performSearch()">Rechercher</button>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
{{ template "layouts/include-js.html" }}

<script type="application/javascript">
    $(document).ready(start);

    function start() {
        $('#promotions').select2();
        $('#cities').select2();
    }

    function performSearch() {
        var limit = getParameterByName('limit');
        var page = getParameterByName('page');
        var promotions = $('#promotions').val();
        var cities = $('#cities').val();
        console.log(limit);
        console.log(page);
        console.log(promotions);
        console.log(cities);

        if (cities === null && promotions === null) {
            return;
        }
        if (cities === null && promotions !== null) {
            window.location.href = String.format('{0}{1}?page={2}&limit={3}&promotions={4}', window.location.origin,
            window.location.pathname, page, limit, promotions.join());
        } else if (cities !== null && promotions === null) {
            window.location.href = String.format('{0}{1}?page={2}&limit={3}&cities={4}', window.location.origin,
                    window.location.pathname, page, limit, cities.join());
        } else {
            window.location.href = String.format('{0}{1}?page={2}&limit={3}&cities={4}&promotions={5}', window.location.origin,
                    window.location.pathname, page, limit, cities.join(), promotions.join());
        }
    }

</script>
</html>